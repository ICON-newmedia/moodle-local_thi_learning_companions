{"version":3,"file":"thi_learning_companions_chat.min.js","sources":["../src/thi_learning_companions_chat.js"],"sourcesContent":["/* eslint-disable no-console, no-unused-vars, max-len, jsdoc/require-jsdoc, no-inner-declarations */\nimport $ from 'jquery';\nimport * as str from 'core/str';\nimport * as ModalFactory from 'core/modal_factory';\nimport * as ModalEvents from 'core/modal_events';\nimport {\n    handleGroupLeaveButton,\n    handleGroupRequestButton,\n    handleGroupInviteButton\n} from 'local_thi_learning_companions/group';\n\nlet strings = [];\n\nexport const init = async() => {\n    // Put send button to the right next to the message box\n    // we can't arrange it that way with just Moodle Forms API\n    const sendButton = $('#local_thi_learning_companions_chat-send');\n    const messageBox = $('#id_messageeditable');\n    messageBox.after(sendButton);\n    // Add event listener to the send button to handle message sending\n    sendButton.on('click', handleNewMessageSubmit);\n\n    addBBBlinkButton();\n    addUploadButton();\n\n    const stringsObj = [\n        {key: 'modal-deletecomment-title', component: 'local_thi_learning_companions'},\n        {key: 'modal-deletecomment-text', component: 'local_thi_learning_companions'},\n        {key: 'modal-deletecomment-okaybutton', component: 'local_thi_learning_companions'},\n        {key: 'modal-editcomment-title', component: 'local_thi_learning_companions'},\n        {key: 'modal-editcomment-okaybutton', component: 'local_thi_learning_companions'},\n        {key: 'modal-reportcomment-title', component: 'local_thi_learning_companions'},\n        {key: 'modal-reportcomment-text', component: 'local_thi_learning_companions'},\n        {key: 'modal-reportcomment-okaybutton', component: 'local_thi_learning_companions'},\n    ];\n\n    // eslint-disable-next-line no-return-assign\n    str.get_strings(stringsObj).then(results => strings = results);\n\n    const body = $('body');\n\n    body.on('click', '.thi_learning_companions_delete_comment', handleCommentDelete);\n    body.on('click', '.thi_learning_companions_edit_comment', handleCommentEdit);\n    body.on('click', '.thi_learning_companions_report_comment', handleCommentReport);\n    body.on('click', '.thi_learning_companions_rate_comment', handleCommentRating);\n    body.on('click', '.thi_learning_companions_editgroup', handleEditGroup);\n\n    body.on('click', '.js-leave-group', handleGroupLeaveButton);\n    body.on('click', '.js-request-join-group', handleGroupRequestButton);\n    body.on('click', '.js-invite-member', handleGroupInviteButton);\n    body.on('click', '.thi_learning_companions_bbb_button', handleBBBButton);\n    body.on('click', '.thi_learning_companions_upload_button', handleUploadButton);\n    let item = document.querySelector('#page-local-thi_learning_companions-chat #fitem_id_attachments');\n    document.body.addEventListener('dragenter', function(e) {\n        // console.log('started dragging', e);\n        document.querySelector('#page-local-thi_learning_companions-chat #fitem_id_attachments').classList.add('upload-visible');\n    });\n    // document.body.addEventListener('dragstop', function(e) {\n    //     console.log('stopped dragging', e);\n    //     document.querySelector('#page-local-thi_learning_companions-chat #fitem_id_attachments').classList.remove('upload-visible');\n    // });\n};\n\nconst addBBBlinkButton = function() {\n    var string = str.get_string(  'bigbluebutton_title', 'local_thi_learning_companions');\n    string.then((title) => {\n        if ($('.atto_editor_row').length > 0) {\n            var appendTo = '#page-local-thi_learning_companions-chat .atto_toolbar_row:first-child';\n        } else {\n            var appendTo = '#page-local-thi_learning_companions-chat .editor_atto_toolbar';\n        }\n        $().add('<div class=\"atto_group accessibility_group\"><button class=\"thi_learning_companions_bbb_button\" title=\"' + title + '\")>BigBlueButton</button></div>').appendTo(appendTo);\n    });\n};\n\nconst addUploadButton = function() {\n    var string = str.get_string(  'upload_title', 'local_thi_learning_companions');\n    string.then((title) => {\n        if ($('.atto_editor_row').length > 0) {\n            var appendTo = '#page-local-thi_learning_companions-chat .atto_toolbar_row:first-child';\n        } else {\n            var appendTo = '#page-local-thi_learning_companions-chat .editor_atto_toolbar';\n        }\n        $().add('<div class=\"atto_group accessibility_group\"><button class=\"thi_learning_companions_upload_button\" title=\"' + title + '\"><i class=\"fa fa-upload\"></i></button></div>').appendTo(appendTo);\n    });\n};\n\nconst handleBBBButton = function(e){\n    e.preventDefault();\n    var sel = window.getSelection();\n    let messageEditorSelected = false;\n    const messageEditor = document.getElementById('id_messageeditable');\n    // eslint-disable-next-line no-cond-assign\n    while (sel = sel.parentNode){\n        if (sel.id === 'id_messageeditable') {\n            messageEditorSelected = true;\n            break;\n        }\n    }\n    if (!messageEditorSelected) {\n        document.getSelection().removeAllRanges();\n        messageEditor.focus();\n        const range = new Range();\n        const childElementCount = messageEditor.childElementCount;\n        let child = Math.max(childElementCount - 1, 0);\n        range.setStartAfter(messageEditor.children[child]);\n        document.getSelection().addRange(range);\n    }\n    var string = str.get_string('bigbluebutton_join_text', 'local_thi_learning_companions');\n    var chatid = $('.chat-post-form input[name=\"chatid\"]').val();\n    var bbbURLs = $.ajax(M.cfg.wwwroot + '/local/thi_learning_companions/ajax/ajax_videocall.php', {data: {chatid:chatid}});\n    Promise.all([string,bbbURLs]).then((data) => {\n        const urls = data[1];\n        window.open(urls['moderator'], '_blank');\n        pasteHtmlAtCaret(' <a target=\"_blank\" href=\"' + urls['participants'] + '\">' + data[0] + '</a>');\n\n    });\n    // ICTODO: Create a new BBB room, then create a link that the users can use to join the room, all via AJAX\n    return false;\n};\n\nconst handleUploadButton = function(e){\n    e.preventDefault();\n    const uploadfield = document.querySelector('#page-local-thi_learning_companions-chat #fitem_id_attachments');\n    let target = e.target;\n    if (target.tagName == \"I\") {\n        target = target.parentElement;\n    }\n    if (uploadfield.classList.contains('upload-visible')) {\n        uploadfield.classList.remove('upload-visible');\n        target.classList.remove('highlight');\n    } else {\n        uploadfield.classList.add('upload-visible');\n        target.classList.add('highlight');\n    }\n};\nconst pasteHtmlAtCaret = function(html) {\n    var sel, range;\n    if (window.getSelection) {\n        // IE9 and non-IE\n        sel = window.getSelection();\n        if (sel.getRangeAt && sel.rangeCount) {\n            range = sel.getRangeAt(0);\n            range.deleteContents();\n\n            // Range.createContextualFragment() would be useful here but is\n            // only relatively recently standardized and is not supported in\n            // some browsers (IE9, for one)\n            var el = document.createElement(\"div\");\n            el.innerHTML = html;\n            var frag = document.createDocumentFragment(), node, lastNode;\n            while ( (node = el.firstChild) ) {\n                lastNode = frag.appendChild(node);\n            }\n            range.insertNode(frag);\n\n            // Preserve the selection\n            if (lastNode) {\n                range = range.cloneRange();\n                range.setStartAfter(lastNode);\n                range.collapse(true);\n                sel.removeAllRanges();\n                sel.addRange(range);\n            }\n        }\n    } else if (document.selection && document.selection.type != \"Control\") {\n        // IE < 9\n        document.selection.createRange().pasteHTML(html);\n    }\n};\nconst handleCommentRating = function(e) {\n    const postId = +e.target.dataset.id;\n    $.ajax({\n        url: M.cfg.wwwroot + '/local/thi_learning_companions/ajax/ajax_ratecomment.php',\n        method: 'POST',\n        dataType: 'json',\n        data: {\n            commentid: postId\n        },\n        success: function(data) {\n            // modal.destroy();\n            if (data === 'fail') {\n                // ICTODO: output fail message\n            } else {\n                // ICTODO: output success message\n            }\n            document.dispatchEvent(new CustomEvent('thi_learning_companions_message_rated', {detail: {postid: postId, newvalue: data.israted}}));\n            // document.dispatchEvent(new ModalEvents.hidden);\n        }\n    });\n};\nconst handleCommentDelete = async function(e) {\n    const postId = +e.target.dataset.id;\n\n    const modal = await ModalFactory.create({\n        type: ModalFactory.types.SAVE_CANCEL,\n        title: strings[0],\n        body: '' +\n            '<div id=\"thi_learning_companions-deletecomment-modal\">' +\n            '<div id=\"thi_learning_companions-deletecomment-modal-text\">' + strings[1] + '</div>' +\n            '</div>',\n    });\n\n    // console.log('comment id from data:', postId);\n\n    modal.getRoot().on(ModalEvents.save, function() {\n        $.ajax({\n            url: M.cfg.wwwroot + '/local/thi_learning_companions/ajax/ajaxdeletecomment.php',\n            method: 'POST',\n            dataType: 'json',\n            data: {\n                commentid: postId\n            },\n            success: function(data) {\n                // modal.destroy();\n                if (data === 'fail') {\n                    // ICTODO: output fail message\n                } else {\n                    // ICTODO: output success message\n                }\n                document.dispatchEvent(new CustomEvent('thi_learning_companions_message_deleted', {detail: {postid: postId}}));\n                // document.dispatchEvent(new ModalEvents.hidden);\n            }\n        });\n    });\n    modal.setSaveButtonText(strings[2]);\n    modal.show();\n};\nconst handleCommentEdit = async function(e) {\n    // console.log('clicked edit comment. event object:', e);\n    // console.log('clicked edit comment for comment id:', e.target.dataset.id);\n    var commentid = e.target.dataset.id;\n    // console.log('commentid before creating modal:', commentid);\n    // console.log(ModalFactory);\n    return ModalFactory.create({\n        type: ModalFactory.types.SAVE_CANCEL,\n        title: strings[3],\n        body: '' +\n            '<div id=\"thi_learning_companions-edit-modal\">' +\n            '<div id=\"thi_learning_companions-edit-modal-text\">' + strings[4] + '</div>' +\n            '</div>',\n        // footer: '' +\n        //     '<div id=\"thi_learning_companions-deletecomment-modal-buttons\">' +\n        //     '<button class=\"btn btn-primary\" aria-hidden=\"true\" id=\"thi_learning_companions-deletecomment-modal-delete\" data-cid=\"' + commentid + '\">' + strings[2] + '</button>' +\n        //     '<button class=\"btn btn-secondary\" aria-hidden=\"true\" id=\"thi_learning_companions-deletecomment-modal-close\" data-action=\"hide\">' + strings[3] + '</button>' +\n        //     '</div>'\n    }).then(function(modal) {\n        // console.log('edit comment id from data:', commentid);\n\n        modal.setSaveButtonText(strings[5]);\n        $.ajax(\n            {\n                url: M.cfg.wwwroot + '/local/thi_learning_companions/editcomment.php',\n                method: 'POST',\n                dataType: 'json',\n                data: {\n                    commentid: commentid\n                }\n            }\n        ).done(function(a, b, c) {\n            // console.log('inside edit comment. a:', a, 'b:', b, 'c:', c);\n            modal.setText(a.text);\n        });\n        // modal.getRoot().on(ModalEvents.hidden, function () {\n        //     modal.destroy();\n        // });\n        modal.show();\n    });\n};\nconst handleCommentReport = async function(e) {\n    const postId = +e.target.dataset.id;\n\n    return ModalFactory.create({\n        type: ModalFactory.types.SAVE_CANCEL,\n        title: strings[5],\n        body: '' +\n            '<div id=\"thi_learning_companions-reportcomment-modal\">' +\n            '<div id=\"thi_learning_companions-reportcomment-modal-text\">' + strings[6] + '</div>' +\n            '</div>'\n    }).then(function(modal) {\n        // console.log('comment id from data:', postId);\n\n        modal.getRoot().on(ModalEvents.save, function() {\n            // console.log('about to call ajaxdeletecomment.php with comment id', postId);\n            $.ajax({\n                url: `${M.cfg.wwwroot}/local/thi_learning_companions/ajax/ajaxreport.php`,\n                method: 'POST',\n                dataType: 'json',\n                data: {\n                    commentid: postId\n                },\n                success: function(data) {\n                    // modal.destroy();\n                    if (data === 'fail') {\n                        // ICTODO: output fail message\n                    } else {\n                        // ICTODO: output success message\n                    }\n                    document.dispatchEvent(new CustomEvent('thi_learning_companions_message_reported', {detail: {postid: postId}}));\n                    // document.dispatchEvent(ModalEvents.hidden);\n                }\n            });\n        });\n        modal.setSaveButtonText(strings[7]);\n        modal.show();\n    });\n};\nconst handleEditGroup = async function(e) {\n    // console.log('clicked on gear icon', this, e);\n\n    async function callGroupModal(e) {\n        e.preventDefault();\n\n        const groupid = e.target.dataset.gid;\n        const groupname = e.target.dataset.title;\n        // console.log('getting group modal for ', groupid, groupname, this, e);\n        const groupDetails = $.ajax({\n            url: M.cfg.wwwroot + '/local/thi_learning_companions/ajax/ajax.php',\n            method: 'POST',\n            dataType: 'json',\n            data: {\n                action: 'getgroupdetails',\n                groupid: groupid,\n                referrer: 'chat'\n            },\n            success: function(data) {\n                console.log('got group details modal with data: ', data);\n                const title = str.get_string('modal-groupdetails-groupname', 'local_thi_learning_companions', groupname);\n                title.then(function(string) {\n                    // console.log('got group title string:', title);\n                    // console.log('got group details data:', data);\n                    ModalFactory.create({\n                        title: string,\n                        body: data.html,\n                        footer: '',\n                        large: true,\n                        type: ModalFactory.types.CANCEL,\n                    }).then(modal => {\n                        modal.show();\n                    });\n                });\n            }\n        });\n    }\n\n    callGroupModal(e).then(() => {\n        console.log('called modal for group details. What now?');\n    });\n};\n\nconst handleNewMessageSubmit = (e) => {\n    if (e.target.getAttribute(\"disabled\") === true) {\n        return;\n    }\n    // ICTODO: disable the form/grey it out, while data is getting sent\n    e.preventDefault();\n    const data = {};\n    $('#thi_learning_companions_chat form input, #thi_learning_companions_chat form textarea').each((index, el) => {\n        data[el.name] = el.value;\n    });\n    $('#thi_learning_companions_chat #id_messageeditable').css('opacity', '0.5');\n    $('#thi_learning_companions_chat #id_messageeditable').attr('contenteditable', 'false');\n    $('#thi_learning_companions_chat form input,  #thi_learning_companions_chat form textarea, #local_thi_learning_companions_chat-send').attr('disabled', true);\n    $.post(\n        M.cfg.wwwroot + \"/local/thi_learning_companions/ajax/ajaxsubmit.php\",\n        data\n    ).done(function(a, b, c) {\n        // ICTODO: give a success message, like with a toast or so\n        // reset the form to empty values after successfully sending the form\n        if (a.warning_body) {\n            console.log('output warning');\n            ModalFactory.create({\n                title: a.warning_title,\n                body: a.warning_body,\n                footer: '',\n                large: false,\n                type: ModalFactory.types.ALERT,\n            }).then(modal => {\n                modal.show();\n            });\n        }\n        $('#thi_learning_companions_chat form #id_messageeditable').text(\"\");\n        $('#thi_learning_companions_chat form input, #thi_learning_companions_chat form textarea').each((index, el) => {\n            if (el.name == \"textarea\" || el.type !== \"hidden\") {\n                el.value = '';\n            }\n        });\n\n        //Update the itemid, because otherwise, if the user tries to upload a file with the same name as the previous one,\n        //it will fail.\n        $('input[type=hidden][name=message\\\\[itemid\\\\]]').val(a.itemid);\n        //We also need to update the itemid inside the template options. Getting the first clientId, which is random, and then\n        //updating the itemid in the options.\n        const clientId = Object.keys(window.M.core_filepicker.instances).pop();\n        if (clientId) {\n            window.M.core_filepicker.instances[clientId].options.itemid = a.itemid;\n        }\n\n        document.dispatchEvent(new CustomEvent('thi_learning_companions_message_send'));\n    }).fail(function(a, b, c) {\n        console.warn('Failed sending via AJAX', a, b, c);\n        window.alert(\"couldn't save\"); // ICTODO: give proper message, via get_string and ideally with a modal\n    }).always(function(a, b, c) {\n        // reactivate the form/ungrey it when data has been sent\n        $('#thi_learning_companions_chat #id_messageeditable').css('opacity', '1');\n        $('#thi_learning_companions_chat #id_messageeditable').attr('contenteditable', 'true');\n        $('#thi_learning_companions_chat form input,  #thi_learning_companions_chat form textarea, #local_thi_learning_companions_chat-send').attr('disabled', false);\n    });\n    return false;\n};\n"],"names":["strings","async","sendButton","after","on","handleNewMessageSubmit","addBBBlinkButton","addUploadButton","str","get_strings","key","component","then","results","body","handleCommentDelete","handleCommentEdit","handleCommentReport","handleCommentRating","handleEditGroup","handleGroupLeaveButton","handleGroupRequestButton","handleGroupInviteButton","handleBBBButton","handleUploadButton","document","querySelector","addEventListener","e","classList","add","get_string","title","length","appendTo","preventDefault","sel","window","getSelection","messageEditorSelected","messageEditor","getElementById","parentNode","id","removeAllRanges","focus","range","Range","childElementCount","child","Math","max","setStartAfter","children","addRange","string","chatid","val","bbbURLs","$","ajax","M","cfg","wwwroot","data","Promise","all","urls","open","pasteHtmlAtCaret","uploadfield","target","tagName","parentElement","contains","remove","html","getRangeAt","rangeCount","deleteContents","el","createElement","innerHTML","node","lastNode","frag","createDocumentFragment","firstChild","appendChild","insertNode","cloneRange","collapse","selection","type","createRange","pasteHTML","postId","dataset","url","method","dataType","commentid","success","dispatchEvent","CustomEvent","detail","postid","newvalue","israted","modal","ModalFactory","create","types","SAVE_CANCEL","getRoot","ModalEvents","save","setSaveButtonText","show","done","a","b","c","setText","text","groupid","gid","groupname","action","referrer","console","log","footer","large","CANCEL","callGroupModal","getAttribute","each","index","name","value","css","attr","post","warning_body","warning_title","ALERT","itemid","clientId","Object","keys","core_filepicker","instances","pop","options","fail","warn","alert","always"],"mappings":"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"}