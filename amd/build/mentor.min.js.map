{"version":3,"file":"mentor.min.js","sources":["../src/mentor.js"],"sourcesContent":["/* eslint-disable max-len, jsdoc/require-jsdoc, require-jsdoc */\ndefine([\n    'jquery',\n    'core/config',\n    'core/str',\n    'core/modal_factory',\n    'core/modal_events',\n    'local_learningcompanions/datatables-helpers',\n    'local_learningcompanions/jquery.dataTables',\n    'local_learningcompanions/select2'\n], function($, c, str, ModalFactory, ModalEvents, datatablesHelpers) {\n\n    async function initDatatables() {\n        datatablesHelpers.initMinSearch('.js-mentor-filter--min');\n        datatablesHelpers.initIncludeSearch('.js-mentor-filter--includes');\n\n        const languageUrl = await str.get_string('datatables_url', 'local_learningcompanions');\n\n        $('#askedquestionstable').DataTable({\n            language: {\n                url: languageUrl\n            }\n        });\n        $('#mymentorquestionstable').DataTable({\n            language: {\n                url: languageUrl\n            }\n        });\n        $('#allmentorquestionstable').DataTable({\n            language: {\n                url: languageUrl\n            }\n        });\n        $('#allmentorstable').DataTable({\n            dom: 'lrtip',\n            language: {\n                url: languageUrl,\n            },\n            initComplete: function() {\n                const table = this.api();\n\n                datatablesHelpers.setupSearchRules('.js-mentor-filter--search', table);\n\n                datatablesHelpers.addRedrawEvent('.js-mentor-filter', table);\n            },\n            columnDefs: [\n                {orderable: false, visible: false, targets: 'no-show'}\n            ]\n        });\n    }\n\n    return {\n\n        select2: function() {\n            $('.select2').select2();\n        },\n\n        init: function() {\n            initDatatables();\n\n            $('.askedquestions-delete').click(function(e) {\n                e.preventDefault();\n\n                const questionid = $(this).data('qid');\n                const question = $(this).data('question');\n\n                var strings = [\n                    {key: 'modal-deletemyquestion-title', component: 'local_learningcompanions'},\n                    {key: 'modal-deletemyquestion-text', component: 'local_learningcompanions', param: question},\n                    {key: 'modal-deletemyquestion-okaybutton', component: 'local_learningcompanions'},\n                    {key: 'modal-deletemyquestion-cancelbutton', component: 'local_learningcompanions'},\n                ];\n\n                str.get_strings(strings).then(function(strings) {\n                    return ModalFactory.create({\n                        title: strings[0],\n                        body: '' +\n                            '<div id=\"mentor-deletemyquestion-modal\">' +\n                            '<div id=\"mentor-deletemyquestion-modal-text\">' + strings[1] + '</div>' +\n                            '</div>',\n                        footer: '' +\n                            '<div id=\"mentor-deletemyquestion-modal-buttons\">' +\n                            '<button class=\"btn btn-primary\" aria-hidden=\"true\" id=\"mentor-deletemyquestion-modal-delete\" data-qid=\"' + questionid + '\">' + strings[2] + '</button>' +\n                            '<button class=\"btn btn-secondary\" aria-hidden=\"true\" id=\"mentor-deletemyquestion-modal-close\" data-action=\"hide\">' + strings[3] + '</button>' +\n                            '</div>'\n                    });\n                }).then(function(modal) {\n                    modal.getRoot().on(ModalEvents.hidden, function() {\n                        modal.destroy();\n                    });\n                    modal.show();\n                });\n            });\n\n            $('body').on('click', '#mentor-deletemyquestion-modal-delete', function() {\n\n                const questionid = $(this).data('qid');\n\n                $.ajax({\n                    url: M.cfg.wwwroot + '/local/learningcompanions/ajax/ajax.php',\n                    method: 'POST',\n                    dataType: 'json',\n                    data: {\n                        action: 'deletemyquestion',\n                        questionid: questionid\n                    },\n                    success: function (data) {\n                        if (data === 'fail') {\n                            window.location.href = (M.cfg.wwwroot + '/local/learningcompanions/mentor/index.php?n=n_d');\n                        } else {\n                            window.location.href = (M.cfg.wwwroot + '/local/learningcompanions/mentor/index.php?n=d');\n                        }\n                    }\n                });\n            });\n\n            $('body').on('click', '#mentor-deletemyquestion-modal-close', function() {\n                $('.modal').remove();\n            });\n        }\n\n    };\n});\n"],"names":["define","$","c","str","ModalFactory","ModalEvents","datatablesHelpers","initMinSearch","initIncludeSearch","get_string","languageUrl","DataTable","language","url","dom","initComplete","table","this","api","setupSearchRules","addRedrawEvent","columnDefs","orderable","visible","targets","select2","init","initDatatables","click","e","preventDefault","questionid","data","strings","key","component","param","get_strings","then","create","title","body","footer","modal","getRoot","on","hidden","destroy","show","ajax","M","cfg","wwwroot","method","dataType","action","success","window","location","href","remove"],"mappings":"gjBACAA,yCAAO,CACH,SACA,cACA,WACA,qBACA,oBACA,8CACA,6CACA,qCACD,SAASC,EAAGC,EAAGC,IAAKC,aAAcC,YAAaC,gHAE9C,+IACIA,kBAAkBC,cAAc,0BAChCD,kBAAkBE,kBAAkB,+CAEVL,IAAIM,WAAW,iBAAkB,mCAArDC,0BAENT,EAAE,wBAAwBU,UAAU,CAChCC,SAAU,CACNC,IAAKH,eAGbT,EAAE,2BAA2BU,UAAU,CACnCC,SAAU,CACNC,IAAKH,eAGbT,EAAE,4BAA4BU,UAAU,CACpCC,SAAU,CACNC,IAAKH,eAGbT,EAAE,oBAAoBU,UAAU,CAC5BG,IAAK,QACLF,SAAU,CACNC,IAAKH,aAETK,aAAc,eACJC,MAAQC,KAAKC,MAEnBZ,kBAAkBa,iBAAiB,4BAA6BH,OAEhEV,kBAAkBc,eAAe,oBAAqBJ,QAE1DK,WAAY,CACR,CAACC,WAAW,EAAOC,SAAS,EAAOC,QAAS,mGAKjD,CAEHC,QAAS,WACLxB,EAAE,YAAYwB,WAGlBC,KAAM,6DACFC,GAEA1B,EAAE,0BAA0B2B,OAAM,SAASC,GACvCA,EAAEC,qBAEIC,WAAa9B,EAAEgB,MAAMe,KAAK,OAG5BC,QAAU,CACV,CAACC,IAAK,+BAAgCC,UAAW,4BACjD,CAACD,IAAK,8BAA+BC,UAAW,2BAA4BC,MAJ/DnC,EAAEgB,MAAMe,KAAK,aAK1B,CAACE,IAAK,oCAAqCC,UAAW,4BACtD,CAACD,IAAK,sCAAuCC,UAAW,6BAG5DhC,IAAIkC,YAAYJ,SAASK,MAAK,SAASL,gBAC5B7B,aAAamC,OAAO,CACvBC,MAAOP,QAAQ,GACfQ,KAAM,wFAEgDR,QAAQ,GAFxD,eAINS,OAAQ,0JAEwGX,WAAa,KAAOE,QAAQ,GAFpI,6HAGkHA,QAAQ,GAH1H,uBAMbK,MAAK,SAASK,OACbA,MAAMC,UAAUC,GAAGxC,YAAYyC,QAAQ,WACnCH,MAAMI,aAEVJ,MAAMK,aAId/C,EAAE,QAAQ4C,GAAG,QAAS,yCAAyC,eAErDd,WAAa9B,EAAEgB,MAAMe,KAAK,OAEhC/B,EAAEgD,KAAK,CACHpC,IAAKqC,EAAEC,IAAIC,QAAU,0CACrBC,OAAQ,OACRC,SAAU,OACVtB,KAAM,CACFuB,OAAQ,mBACRxB,WAAYA,YAEhByB,QAAS,SAAUxB,MAEXyB,OAAOC,SAASC,KADP,SAAT3B,KACwBkB,EAAEC,IAAIC,QAAU,mDAEhBF,EAAEC,IAAIC,QAAU,uDAMxDnD,EAAE,QAAQ4C,GAAG,QAAS,wCAAwC,WAC1D5C,EAAE,UAAU2D"}