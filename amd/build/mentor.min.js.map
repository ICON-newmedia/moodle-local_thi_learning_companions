{"version":3,"file":"mentor.min.js","sources":["../src/mentor.js"],"sourcesContent":["/* eslint-disable max-len, jsdoc/require-jsdoc, require-jsdoc */\r\ndefine([\r\n    'jquery',\r\n    'core/config',\r\n    'core/str',\r\n    'core/modal_factory',\r\n    'core/modal_events',\r\n    'local_learningcompanions/datatables-helpers',\r\n    // 'local_learningcompanions/jquery.dataTables',\r\n    'local_learningcompanions/datatables',\r\n    'local_learningcompanions/select2'\r\n], function($, c, str, ModalFactory, ModalEvents, datatablesHelpers) {\r\n\r\n    async function initDatatables() {\r\n        datatablesHelpers.initMinSearch('.js-mentor-filter--min');\r\n        datatablesHelpers.initIncludeSearch('.js-mentor-filter--includes');\r\n\r\n        const languageUrl = await str.get_string('datatables_url', 'local_learningcompanions');\r\n\r\n        $('#askedquestionstable').DataTable({\r\n            language: {\r\n                url: languageUrl\r\n            }\r\n        });\r\n        $('#mymentorquestionstable').DataTable({\r\n            language: {\r\n                url: languageUrl\r\n            }\r\n        });\r\n        $('#allmentorquestionstable').DataTable({\r\n            language: {\r\n                url: languageUrl\r\n            }\r\n        });\r\n        $('#allmentorstable').DataTable({\r\n            dom: 'lrtip',\r\n            language: {\r\n                url: languageUrl,\r\n            },\r\n            initComplete: function() {\r\n                const table = this.api();\r\n\r\n                datatablesHelpers.setupSearchRules('.js-mentor-filter--search', table);\r\n\r\n                datatablesHelpers.addRedrawEvent('.js-mentor-filter', table);\r\n            },\r\n            columnDefs: [\r\n                {orderable: false, visible: false, targets: 'no-show'}\r\n            ]\r\n        });\r\n    }\r\n\r\n    return {\r\n\r\n        select2: function() {\r\n            $('.select2').select2();\r\n        },\r\n\r\n        init: function() {\r\n            initDatatables();\r\n\r\n            $('.askedquestions-delete').click(function(e) {\r\n                e.preventDefault();\r\n\r\n                const questionid = $(this).data('qid');\r\n                const question = $(this).data('question');\r\n\r\n                var strings = [\r\n                    {key: 'modal-deletemyquestion-title', component: 'local_learningcompanions'},\r\n                    {key: 'modal-deletemyquestion-text', component: 'local_learningcompanions', param: question},\r\n                    {key: 'modal-deletemyquestion-okaybutton', component: 'local_learningcompanions'},\r\n                    {key: 'modal-deletemyquestion-cancelbutton', component: 'local_learningcompanions'},\r\n                ];\r\n\r\n                str.get_strings(strings).then(function(strings) {\r\n                    return ModalFactory.create({\r\n                        title: strings[0],\r\n                        body: '' +\r\n                            '<div id=\"mentor-deletemyquestion-modal\">' +\r\n                            '<div id=\"mentor-deletemyquestion-modal-text\">' + strings[1] + '</div>' +\r\n                            '</div>',\r\n                        footer: '' +\r\n                            '<div id=\"mentor-deletemyquestion-modal-buttons\">' +\r\n                            '<button class=\"btn btn-primary\" aria-hidden=\"true\" id=\"mentor-deletemyquestion-modal-delete\" data-qid=\"' + questionid + '\">' + strings[2] + '</button>' +\r\n                            '<button class=\"btn btn-secondary\" aria-hidden=\"true\" id=\"mentor-deletemyquestion-modal-close\" data-action=\"hide\">' + strings[3] + '</button>' +\r\n                            '</div>'\r\n                    });\r\n                }).then(function(modal) {\r\n                    modal.getRoot().on(ModalEvents.hidden, function() {\r\n                        modal.destroy();\r\n                    });\r\n                    modal.show();\r\n                });\r\n            });\r\n\r\n            $('body').on('click', '#mentor-deletemyquestion-modal-delete', function() {\r\n\r\n                const questionid = $(this).data('qid');\r\n\r\n                $.ajax({\r\n                    url: M.cfg.wwwroot + '/local/learningcompanions/ajax/ajax.php',\r\n                    method: 'POST',\r\n                    dataType: 'json',\r\n                    data: {\r\n                        action: 'deletemyquestion',\r\n                        questionid: questionid\r\n                    },\r\n                    success: function (data) {\r\n                        if (data === 'fail') {\r\n                            window.location.href = (M.cfg.wwwroot + '/local/learningcompanions/mentor/index.php?n=n_d');\r\n                        } else {\r\n                            window.location.href = (M.cfg.wwwroot + '/local/learningcompanions/mentor/index.php?n=d');\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n\r\n            $('body').on('click', '#mentor-deletemyquestion-modal-close', function() {\r\n                $('.modal').remove();\r\n            });\r\n        }\r\n\r\n    };\r\n});\r\n"],"names":["define","$","c","str","ModalFactory","ModalEvents","datatablesHelpers","select2","init","initMinSearch","initIncludeSearch","languageUrl","get_string","DataTable","language","url","dom","initComplete","table","this","api","setupSearchRules","addRedrawEvent","columnDefs","orderable","visible","targets","initDatatables","click","e","preventDefault","questionid","data","strings","key","component","param","get_strings","then","create","title","body","footer","modal","getRoot","on","hidden","destroy","show","ajax","M","cfg","wwwroot","method","dataType","action","success","window","location","href","remove"],"mappings":"AACAA,yCAAO,CACH,SACA,cACA,WACA,qBACA,oBACA,8CAEA,sCACA,qCACD,SAASC,EAAGC,EAAGC,IAAKC,aAAcC,YAAaC,yBAyCvC,CAEHC,QAAS,WACLN,EAAE,YAAYM,WAGlBC,KAAM,6BA5CNF,kBAAkBG,cAAc,0BAChCH,kBAAkBI,kBAAkB,qCAE9BC,kBAAoBR,IAAIS,WAAW,iBAAkB,4BAE3DX,EAAE,wBAAwBY,UAAU,CAChCC,SAAU,CACNC,IAAKJ,eAGbV,EAAE,2BAA2BY,UAAU,CACnCC,SAAU,CACNC,IAAKJ,eAGbV,EAAE,4BAA4BY,UAAU,CACpCC,SAAU,CACNC,IAAKJ,eAGbV,EAAE,oBAAoBY,UAAU,CAC5BG,IAAK,QACLF,SAAU,CACNC,IAAKJ,aAETM,aAAc,iBACJC,MAAQC,KAAKC,MAEnBd,kBAAkBe,iBAAiB,4BAA6BH,OAEhEZ,kBAAkBgB,eAAe,oBAAqBJ,QAE1DK,WAAY,CACR,CAACC,WAAW,EAAOC,SAAS,EAAOC,QAAS,cAYhDC,GAEA1B,EAAE,0BAA0B2B,OAAM,SAASC,GACvCA,EAAEC,uBAEIC,WAAa9B,EAAEkB,MAAMa,KAAK,WAG5BC,QAAU,CACV,CAACC,IAAK,+BAAgCC,UAAW,4BACjD,CAACD,IAAK,8BAA+BC,UAAW,2BAA4BC,MAJ/DnC,EAAEkB,MAAMa,KAAK,aAK1B,CAACE,IAAK,oCAAqCC,UAAW,4BACtD,CAACD,IAAK,sCAAuCC,UAAW,6BAG5DhC,IAAIkC,YAAYJ,SAASK,MAAK,SAASL,gBAC5B7B,aAAamC,OAAO,CACvBC,MAAOP,QAAQ,GACfQ,KAAM,wFAEgDR,QAAQ,GAFxD,eAINS,OAAQ,0JAEwGX,WAAa,KAAOE,QAAQ,GAFpI,6HAGkHA,QAAQ,GAH1H,uBAMbK,MAAK,SAASK,OACbA,MAAMC,UAAUC,GAAGxC,YAAYyC,QAAQ,WACnCH,MAAMI,aAEVJ,MAAMK,aAId/C,EAAE,QAAQ4C,GAAG,QAAS,yCAAyC,iBAErDd,WAAa9B,EAAEkB,MAAMa,KAAK,OAEhC/B,EAAEgD,KAAK,CACHlC,IAAKmC,EAAEC,IAAIC,QAAU,0CACrBC,OAAQ,OACRC,SAAU,OACVtB,KAAM,CACFuB,OAAQ,mBACRxB,WAAYA,YAEhByB,QAAS,SAAUxB,MAEXyB,OAAOC,SAASC,KADP,SAAT3B,KACwBkB,EAAEC,IAAIC,QAAU,mDAEhBF,EAAEC,IAAIC,QAAU,uDAMxDnD,EAAE,QAAQ4C,GAAG,QAAS,wCAAwC,WAC1D5C,EAAE,UAAU2D"}