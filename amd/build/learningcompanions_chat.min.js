define("local_learningcompanions/learningcompanions_chat",["jquery","core/str","core/modal_factory","core/modal_events"],(function($,str,ModalFactory,ModalEvents){return{init:function(){var sendButton=$("#local_learningcompanions_chat-send");$("#id_messageeditable").after(sendButton),$("#local_learningcompanions_chat-send").on("click",(function(e){if(1!=e.target.getAttribute("disabled")){e.preventDefault();var data={};return $("#learningcompanions_chat form input, #learningcompanions_chat form textarea").each(((index,el)=>{data[el.name]=el.value})),$("#learningcompanions_chat #id_messageeditable").css("opacity","0.5"),$("#learningcompanions_chat #id_messageeditable").attr("contenteditable","false"),$("#learningcompanions_chat form input,  #learningcompanions_chat form textarea, #local_learningcompanions_chat-send").attr("disabled",!0),$.post(M.cfg.wwwroot+"/local/learningcompanions/ajaxsubmit.php",data).done((function(a,b,c){$("#learningcompanions_chat form #id_messageeditable").text(""),$("#learningcompanions_chat form input, #learningcompanions_chat form textarea").each(((index,el)=>{"textarea"!=el.name&&"hidden"===el.type||(el.value="")}))})).fail((function(a,b,c){console.warn("Failed sending via AJAX",a,b,c),window.alert("couldn't save")})).always((function(){$("#learningcompanions_chat #id_messageeditable").css("opacity","1"),$("#learningcompanions_chat #id_messageeditable").attr("contenteditable","true"),$("#learningcompanions_chat form input,  #learningcompanions_chat form textarea, #local_learningcompanions_chat-send").attr("disabled",!1)})),!1}}));str.get_strings([{key:"modal-deletecomment-title",component:"local_learningcompanions"},{key:"modal-deletecomment-text",component:"local_learningcompanions"},{key:"modal-deletecomment-okaybutton",component:"local_learningcompanions"},{key:"modal-editcomment-title",component:"local_learningcompanions"},{key:"modal-editcomment-okaybutton",component:"local_learningcompanions"},{key:"modal-reportcomment-title",component:"local_learningcompanions"},{key:"modal-reportcomment-text",component:"local_learningcompanions"},{key:"modal-reportcomment-okaybutton",component:"local_learningcompanions"}]).then((function(strings){$("#learningcompanions_chat-postlist").on("click",(function(e){if(e.target.classList.contains("learningcompanions_delete_comment")){console.log("clicked delete comment. event object:",e),console.log("clicked delete comment for comment id:",e.target.dataset.id);var commentid=e.target.dataset.id;return console.log("commentid before creating modal:",commentid),console.log(ModalFactory),ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:strings[0],body:'<div id="learningcompanions-deletecomment-modal"><div id="learningcompanions-deletecomment-modal-text">'+strings[1]+"</div></div>"}).then((function(modal){console.log("comment id from data:",commentid),modal.getRoot().on(ModalEvents.save,(function(){console.log("about to call ajaxdeletecomment.php with comment id",commentid),$.ajax({url:M.cfg.wwwroot+"/local/learningcompanions/ajaxdeletecomment.php",method:"POST",dataType:"json",data:{commentid:commentid},success:function(data){document.dispatchEvent(new CustomEvent("learningcompanions_message_deleted")),document.dispatchEvent(new ModalEvents.hidden)}})})),modal.setSaveButtonText(strings[2]),modal.show()}))}if(e.target.classList.contains("learningcompanions_edit_comment")){console.log("clicked edit comment. event object:",e),console.log("clicked edit comment for comment id:",e.target.dataset.id);commentid=e.target.dataset.id;return console.log("commentid before creating modal:",commentid),console.log(ModalFactory),ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:strings[3],body:'<div id="learningcompanions-edit-modal"><div id="learningcompanions-edit-modal-text">'+strings[4]+"</div></div>"}).then((function(modal){console.log("edit comment id from data:",commentid),modal.setSaveButtonText(strings[5]),$.ajax({url:M.cfg.wwwroot+"/local/learningcompanions/editcomment.php",method:"POST",dataType:"json",data:{commentid:commentid}}).done((function(a,b,c){console.log("inside edit comment. a:",a,"b:",b,"c:",c),modal.setText(a.text)})),modal.show()}))}if(e.target.classList.contains("learningcompanions_report_comment")){console.log("clicked report comment. event object:",e),console.log("clicked report comment for comment id:",e.target.dataset.id);commentid=e.target.dataset.id;return console.log("commentid before creating modal:",commentid),console.log(ModalFactory),ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:strings[5],body:'<div id="learningcompanions-reportcomment-modal"><div id="learningcompanions-reportcomment-modal-text">'+strings[6]+"</div></div>"}).then((function(modal){console.log("comment id from data:",commentid),modal.getRoot().on(ModalEvents.save,(function(){console.log("about to call ajaxdeletecomment.php with comment id",commentid),$.ajax({url:M.cfg.wwwroot+"/local/learningcompanions/ajaxreportcomment.php",method:"POST",dataType:"json",data:{commentid:commentid},success:function(data){document.dispatchEvent(new CustomEvent("learningcompanions_message_reported")),document.dispatchEvent(new ModalEvents.hidden)}})})),modal.setSaveButtonText(strings[2]),modal.show()}))}}))}))}}}));

//# sourceMappingURL=learningcompanions_chat.min.js.map