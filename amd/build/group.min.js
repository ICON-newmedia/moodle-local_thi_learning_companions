function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("local_learningcompanions/group",["exports","jquery","core/str","core/modal_factory","core/modal_events","local_learningcompanions/datatables-helpers","local_learningcompanions/ajax","local_learningcompanions/jquery.dataTables","local_learningcompanions/select2","core_form/dynamicform","core/templates","local_learningcompanions/invite_members"],(function(_exports,_jquery,str,ModalFactory,ModalEvents,datatablesHelpers,_ajax,_jquery2,_select,_dynamicform,_templates,_invite_members){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.select2=_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),str=_interopRequireWildcard(str),ModalFactory=_interopRequireWildcard(ModalFactory),ModalEvents=_interopRequireWildcard(ModalEvents),datatablesHelpers=_interopRequireWildcard(datatablesHelpers),_dynamicform=_interopRequireDefault(_dynamicform),_templates=_interopRequireDefault(_templates);_exports.select2=function(){(0,_jquery.default)(".select2").select2()};_exports.init=function(){setupDatatables(),attachEvents()};var _ref,_ref2,_ref3,_ref4,_ref5,_ref6,setupDatatables=(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var url;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return datatablesHelpers.initMinSearch(".js-group-filter--min"),datatablesHelpers.initIncludeSearch(".js-group-filter--includes"),_context.next=4,str.get_string("datatables_url","local_learningcompanions");case 4:url=_context.sent,(0,_jquery.default)("#allgroupstable").DataTable({dom:"lrtip",language:{url:url},initComplete:function(){var table=this.api();datatablesHelpers.setupSearchRules(".js-group-filter--search",table),datatablesHelpers.addRedrawEvent(".js-group-filter",table)}});case 6:case"end":return _context.stop()}}),_callee)}))),function(){return _ref.apply(this,arguments)}),attachEvents=function(){var body=(0,_jquery.default)("body");(0,_jquery.default)(".grouprow").click(handleTableRowClick),body.on("click","#mentor-deletemyquestion-modal-close",(function(){return(0,_jquery.default)(".modal").remove()})),body.on("click",".js-leave-group",handleGroupLeaveButton),body.on("click",".js-request-join-group",handleGroupRequestButton),body.on("click",".js-join-group",handleGroupJoinButton),body.on("click",".js-invite-member",handleGroupInviteButton)},handleGroupInviteButton=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(e){var groupId,templatePromise,titlePromise,_yield$Promise$all,_yield$Promise$all2,html,title,modal;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return e.preventDefault(),groupId=(0,_jquery.default)(this).data("groupid"),templatePromise=_templates.default.renderForPromise("local_learningcompanions/group/group_invite",{groupId:groupId}),titlePromise=str.get_string("group_invite_title","local_learningcompanions"),_context2.next=6,Promise.all([templatePromise,titlePromise]);case 6:return _yield$Promise$all=_context2.sent,_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2),html=_yield$Promise$all2[0].html,title=_yield$Promise$all2[1],_context2.next=12,ModalFactory.create({title:title,body:html,footer:"",large:!1});case 12:(modal=_context2.sent).getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show(),(0,_invite_members.init)();case 16:case"end":return _context2.stop()}}),_callee2,this)}))),function(_x){return _ref2.apply(this,arguments)}),handleTableRowClick=(_ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(e){var groupid,groupname,groupDetailsPromise,titlePromise,_yield$Promise$all3,_yield$Promise$all4,html,title,modal;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return e.preventDefault(),groupid=(0,_jquery.default)(this).data("gid"),groupname=(0,_jquery.default)(this).data("title"),groupDetailsPromise=(0,_ajax.promiseAjax)(M.cfg.wwwroot+"/local/learningcompanions/ajax.php",{action:"getgroupdetails",groupid:groupid}),titlePromise=str.get_string("modal-groupdetails-groupname","local_learningcompanions",groupname),_context3.next=7,Promise.all([groupDetailsPromise,titlePromise]);case 7:return _yield$Promise$all3=_context3.sent,_yield$Promise$all4=_slicedToArray(_yield$Promise$all3,2),html=_yield$Promise$all4[0].html,title=_yield$Promise$all4[1],_context3.next=13,ModalFactory.create({title:title,body:html,footer:"",large:!0});case 13:(modal=_context3.sent).getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show();case 16:case"end":return _context3.stop()}}),_callee3,this)}))),function(_x2){return _ref3.apply(this,arguments)}),handleGroupLeaveButton=(_ref4=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(e){var groupId,response,possibleNewAdminsBodyPromise,titlePromise,_yield$Promise$all5,_yield$Promise$all6,possibleNewAdminsBody,title,modal,newAdminForm,templatePromise,_titlePromise,_yield$Promise$all7,_yield$Promise$all8,html,_title,_modal,confirmLeaveForm;return regeneratorRuntime.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return e.preventDefault(),groupId=(0,_jquery.default)(this).data("groupid"),_context4.next=4,(0,_ajax.promiseAjax)(M.cfg.wwwroot+"/local/learningcompanions/ajax.php",{action:"leavegroup",groupid:groupId});case 4:if(!(response=_context4.sent).needsNewAdmin){_context4.next=22;break}return possibleNewAdminsBodyPromise=(0,_ajax.promiseAjax)(M.cfg.wwwroot+"/local/learningcompanions/ajax.php",{action:"getpossiblenewadmins",groupid:groupId}),titlePromise=str.get_string("modal-groupdetails-needsnewadmin","local_learningcompanions"),_context4.next=10,Promise.all([possibleNewAdminsBodyPromise,titlePromise]);case 10:return _yield$Promise$all5=_context4.sent,_yield$Promise$all6=_slicedToArray(_yield$Promise$all5,2),possibleNewAdminsBody=_yield$Promise$all6[0],title=_yield$Promise$all6[1],_context4.next=16,ModalFactory.create({title:title,body:possibleNewAdminsBody,footer:"",large:!1});case 16:(modal=_context4.sent).getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show(),(newAdminForm=new _dynamicform.default(document.querySelector("#formcontainer"),"local_learningcompanions\\forms\\assign_new_admin_while_leaving_form")).load({groupId:groupId}),newAdminForm.addEventListener(newAdminForm.events.FORM_SUBMITTED,(function(){window.location.reload()}));case 22:if(!response.isLastMember){_context4.next=40;break}return templatePromise=_templates.default.renderForPromise("local_learningcompanions/group/group_modal_confirm_leave",{}),_titlePromise=str.get_string("modal-groupdetails-leavetitle","local_learningcompanions"),_context4.next=27,Promise.all([templatePromise,_titlePromise]);case 27:return _yield$Promise$all7=_context4.sent,_yield$Promise$all8=_slicedToArray(_yield$Promise$all7,2),html=_yield$Promise$all8[0].html,_title=_yield$Promise$all8[1],_context4.next=33,ModalFactory.create({title:_title,body:html,footer:"",large:!1});case 33:(_modal=_context4.sent).getRoot().on(ModalEvents.hidden,(function(){_modal.destroy()})),_modal.show(),(confirmLeaveForm=new _dynamicform.default(document.querySelector("#formcontainer"),"local_learningcompanions\\forms\\last_user_leaves_closed_group_form")).load({groupId:groupId}),confirmLeaveForm.addEventListener(confirmLeaveForm.events.FORM_SUBMITTED,(function(){window.location.reload()})),confirmLeaveForm.addEventListener(confirmLeaveForm.events.FORM_CANCELLED,(function(){_modal.destroy()}));case 40:response.leaved&&window.location.reload();case 41:case"end":return _context4.stop()}}),_callee4,this)}))),function(_x3){return _ref4.apply(this,arguments)}),handleGroupRequestButton=(_ref5=_asyncToGenerator(regeneratorRuntime.mark((function _callee5(e){var errorMessage;return regeneratorRuntime.wrap((function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return e.preventDefault(),_context5.next=3,(0,_ajax.promiseAjax)(M.cfg.wwwroot+"/local/learningcompanions/ajax.php",{action:"requestgroupjoin",groupid:(0,_jquery.default)(this).data("groupid")});case 3:if(_context5.sent){_context5.next=8;break}window.location.reload(),_context5.next=12;break;case 8:return _context5.next=10,str.get_string("group_request_not_possible","local_learningcompanions");case 10:errorMessage=_context5.sent,alert(errorMessage);case 12:case"end":return _context5.stop()}}),_callee5,this)}))),function(_x4){return _ref5.apply(this,arguments)}),handleGroupJoinButton=(_ref6=_asyncToGenerator(regeneratorRuntime.mark((function _callee6(e){return regeneratorRuntime.wrap((function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return e.preventDefault(),_context6.next=3,(0,_ajax.promiseAjax)(M.cfg.wwwroot+"/local/learningcompanions/ajax.php",{action:"joingroup",groupid:(0,_jquery.default)(this).data("groupid")});case 3:_context6.sent||window.location.reload();case 5:case"end":return _context6.stop()}}),_callee6,this)}))),function(_x5){return _ref6.apply(this,arguments)})}));

//# sourceMappingURL=group.min.js.map