define("local_learningcompanions/group",["exports","jquery","core/str","core/modal_factory","core/modal_events","local_learningcompanions/datatables-helpers","local_learningcompanions/ajax","local_learningcompanions/jquery.dataTables","local_learningcompanions/select2"],(function(_exports,_jquery,str,ModalFactory,ModalEvents,datatablesHelpers,_ajax,_jquery2,_select){var obj;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.select2=_exports.init=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj},str=_interopRequireWildcard(str),ModalFactory=_interopRequireWildcard(ModalFactory),ModalEvents=_interopRequireWildcard(ModalEvents),datatablesHelpers=_interopRequireWildcard(datatablesHelpers);_exports.select2=()=>{(0,_jquery.default)(".select2").select2()};_exports.init=()=>{setupDatatables(),attachEvents()};const setupDatatables=async()=>{datatablesHelpers.initMinSearch(".js-group-filter--min"),datatablesHelpers.initIncludeSearch(".js-group-filter--includes");const url=await str.get_string("datatables_url","local_learningcompanions");(0,_jquery.default)("#allgroupstable").DataTable({dom:"lrtip",language:{url:url},initComplete:function(){const table=this.api();datatablesHelpers.setupSearchRules(".js-group-filter--search",table),datatablesHelpers.addRedrawEvent(".js-group-filter",table)}})},attachEvents=()=>{const body=(0,_jquery.default)("body");(0,_jquery.default)(".grouprow").click((async function(e){e.preventDefault();const groupid=(0,_jquery.default)(this).data("gid"),groupname=(0,_jquery.default)(this).data("title"),groupDetails=await(0,_ajax.promiseAjax)(M.cfg.wwwroot+"/local/learningcompanions/ajax.php",{action:"getgroupdetails",groupid:groupid}),title=await str.get_string("modal-groupdetails-groupname","local_learningcompanions",groupname),modal=await ModalFactory.create({title:title,body:groupDetails,footer:"",large:!0});modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show()})),body.on("click","#mentor-deletemyquestion-modal-close",(function(){(0,_jquery.default)(".modal").remove()})),body.on("click",".js-leave-group",(async function(e){e.preventDefault();await(0,_ajax.promiseAjax)(M.cfg.wwwroot+"/local/learningcompanions/ajax.php",{action:"leavegroup",groupid:(0,_jquery.default)(this).data("groupid")})||window.location.reload()})),body.on("click",".js-request-join-group",(async function(e){e.preventDefault();if(await(0,_ajax.promiseAjax)(M.cfg.wwwroot+"/local/learningcompanions/ajax.php",{action:"requestgroupjoin",groupid:(0,_jquery.default)(this).data("groupid")})){const errorMessage=await str.get_string("group_request_not_possible","local_learningcompanions");alert(errorMessage)}else window.location.reload()})),body.on("click",".js-join-group",(async function(e){e.preventDefault();await(0,_ajax.promiseAjax)(M.cfg.wwwroot+"/local/learningcompanions/ajax.php",{action:"joingroup",groupid:(0,_jquery.default)(this).data("groupid")})||window.location.reload()}))}}));

//# sourceMappingURL=group.min.js.map