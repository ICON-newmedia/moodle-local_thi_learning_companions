define("local_learningcompanions/group",["exports","jquery","core/str","core/modal_factory","core/modal_events","local_learningcompanions/datatables-helpers","local_learningcompanions/ajax","local_learningcompanions/jquery.dataTables","local_learningcompanions/select2","core_form/dynamicform","core/templates","local_learningcompanions/invite_members"],(function(_exports,_jquery,str,ModalFactory,ModalEvents,datatablesHelpers,_ajax,_jquery2,_select,_dynamicform,_templates,_invite_members){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.select2=_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),str=_interopRequireWildcard(str),ModalFactory=_interopRequireWildcard(ModalFactory),ModalEvents=_interopRequireWildcard(ModalEvents),datatablesHelpers=_interopRequireWildcard(datatablesHelpers),_dynamicform=_interopRequireDefault(_dynamicform),_templates=_interopRequireDefault(_templates);_exports.select2=()=>{(0,_jquery.default)(".select2").select2()};_exports.init=()=>{console.log("init"),setupDatatables(),attachEvents()};const setupDatatables=async()=>{datatablesHelpers.initMinSearch(".js-group-filter--min"),datatablesHelpers.initIncludeSearch(".js-group-filter--includes");const url=await str.get_string("datatables_url","local_learningcompanions");(0,_jquery.default)("#allgroupstable").DataTable({dom:"lrtip",language:{url:url},initComplete:function(){const table=this.api();datatablesHelpers.setupSearchRules(".js-group-filter--search",table),datatablesHelpers.addRedrawEvent(".js-group-filter",table),document.querySelector('input[data-target="course"]').dispatchEvent(new Event("change"))}})},attachEvents=()=>{const body=(0,_jquery.default)("body");(0,_jquery.default)(".grouprow").click(handleTableRowClick),body.on("click","#mentor-deletemyquestion-modal-close",(()=>(0,_jquery.default)(".modal").remove())),body.on("click",".js-leave-group",handleGroupLeaveButton),body.on("click",".js-request-join-group",handleGroupRequestButton),body.on("click",".js-join-group",handleGroupJoinButton),body.on("click",".js-invite-member",handleGroupInviteButton)},handleGroupInviteButton=async function(e){e.preventDefault();const groupId=(0,_jquery.default)(this).data("groupid"),{html:html}=await _templates.default.renderForPromise("local_learningcompanions/group/group_invite",{groupId:groupId}),modal=await ModalFactory.create({title:"Invite member",body:html,footer:"",large:!1});modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show(),(0,_invite_members.init)()},handleTableRowClick=async function(e){e.preventDefault();const groupid=(0,_jquery.default)(this).data("gid"),groupname=(0,_jquery.default)(this).data("title"),groupDetails=await(0,_ajax.promiseAjax)(M.cfg.wwwroot+"/local/learningcompanions/ajax.php",{action:"getgroupdetails",groupid:groupid}),title=await str.get_string("modal-groupdetails-groupname","local_learningcompanions",groupname),modal=await ModalFactory.create({title:title,body:groupDetails.html,footer:"",large:!0});modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show()},handleGroupLeaveButton=async function(e){e.preventDefault();const groupId=(0,_jquery.default)(this).data("groupid"),response=await(0,_ajax.promiseAjax)(M.cfg.wwwroot+"/local/learningcompanions/ajax.php",{action:"leavegroup",groupid:groupId});if(response.needsNewAdmin){const possibleNewAdminsBody=await(0,_ajax.promiseAjax)(M.cfg.wwwroot+"/local/learningcompanions/ajax.php",{action:"getpossiblenewadmins",groupid:groupId}),title=await str.get_string("modal-groupdetails-needsnewadmin","local_learningcompanions"),modal=await ModalFactory.create({title:title,body:possibleNewAdminsBody,footer:"",large:!1});modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show();const newAdminForm=new _dynamicform.default(document.querySelector("#formcontainer"),"local_learningcompanions\\forms\\assign_new_admin_while_leaving_form");newAdminForm.load({groupId:groupId}),newAdminForm.addEventListener(newAdminForm.events.FORM_SUBMITTED,(()=>{window.location.reload()}))}response.leaved&&window.location.reload()},handleGroupRequestButton=async function(e){e.preventDefault();if(await(0,_ajax.promiseAjax)(M.cfg.wwwroot+"/local/learningcompanions/ajax.php",{action:"requestgroupjoin",groupid:(0,_jquery.default)(this).data("groupid")})){const errorMessage=await str.get_string("group_request_not_possible","local_learningcompanions");alert(errorMessage)}else window.location.reload()},handleGroupJoinButton=async function(e){e.preventDefault();await(0,_ajax.promiseAjax)(M.cfg.wwwroot+"/local/learningcompanions/ajax.php",{action:"joingroup",groupid:(0,_jquery.default)(this).data("groupid")})||window.location.reload()}}));

//# sourceMappingURL=group.min.js.map