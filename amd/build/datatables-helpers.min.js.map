{"version":3,"file":"datatables-helpers.min.js","sources":["../src/datatables-helpers.js"],"sourcesContent":["/* eslint-disable jsdoc/require-param-type, valid-jsdoc */\r\nimport $ from 'jquery';\r\nimport 'local_learningcompanions/datatables';\r\n\r\n/**\r\n * Adds a default \"value is included in the column\" search to the datatables search.\r\n *\r\n * @param selector {string}\r\n * @param table {*}\r\n */\r\nexport const setupSearchRules = (selector, table) => {\r\n    $(selector).each(function() {\r\n        $(this).on('keyup change clear', function() {\r\n            let elementValue;\r\n\r\n            if (this.type === 'checkbox') {\r\n                elementValue = this.checked ? 1 : '';\r\n            } else {\r\n                elementValue = this.value;\r\n            }\r\n\r\n            let column;\r\n            // Check of the target is a number\r\n            if (isNaN($(this).data('target'))) {\r\n                column = table.column(`.${$(this).data('target')}`);\r\n            } else {\r\n                column = table.column($(this).data('target'));\r\n            }\r\n            column.search(elementValue).draw();\r\n        });\r\n    });\r\n};\r\n\r\n/**\r\n * Adds the elements to the datatables search, for an OR value search.\r\n * The elements need a data-target attribute, which is the column index or class to search.\r\n *\r\n * @param selector\r\n */\r\nexport const initOrSearch = (selector) => {\r\n    $(selector).each(function() {\r\n        addOrSearch($(this));\r\n    });\r\n};\r\n\r\n/**\r\n * Adds a specific element to the datatables search, for an OR value search.\r\n *\r\n * @param element {jQuery} The element the search relates to.\r\n */\r\nexport const addOrSearch = (element) => {\r\n    $.fn.dataTable.ext.search.push(function(settings, data) {\r\n        let searchVal = element.val() ?? '';\r\n\r\n        //If the search value is empty, don´t filter it.\r\n        if (!searchVal) {\r\n            return true;\r\n        }\r\n\r\n        const indexes = getTargetColumnIndexes(settings, element);\r\n        if (indexes === null) {\r\n            return true;\r\n        }\r\n\r\n        for (const index of indexes) {\r\n            /**\r\n             * @type {string}\r\n             */\r\n            if (data[index].includes(searchVal)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    });\r\n};\r\n\r\n/**\r\n * Adds the elements to the datatables search, for a minimum value search.\r\n * The elements need a data-target attribute, which is the column index to search.\r\n *\r\n * @param selector\r\n */\r\nexport const initMinSearch = (selector) => {\r\n    $(selector).each(function() {\r\n        addMinSearch($(this));\r\n    });\r\n};\r\n\r\n/**\r\n * Adds a specific element to the datatables search, for a minimum value search.\r\n *\r\n * @param element {jQuery} The element the search relates to.\r\n */\r\nexport const addMinSearch = (element) => {\r\n    $.fn.dataTable.ext.search.push(function(settings, data) {\r\n        let min = element.val() ?? '';\r\n\r\n        if (!min) {\r\n            return true;\r\n        }\r\n\r\n        if (element.attr('type') === 'date') {\r\n            const minDate = new Date(min);\r\n            min = minDate.getTime() / 1000;\r\n        }\r\n\r\n        let index = getTargetColumnIndexes(settings, element);\r\n        if (index === null) {\r\n            return true;\r\n        }\r\n        index = index[0];\r\n\r\n        /**\r\n         * @type {number}\r\n         */\r\n        const value = +data[index];\r\n        if (min) {\r\n            return value >= min;\r\n        }\r\n        return true;\r\n    });\r\n};\r\n\r\n/**\r\n * Adds a specific select element to the datatables search, for an include search value search.\r\n * The element should be an element, that can select multiple values. Otherwise, just use the setupSearchRules function.\r\n * The elements should have a data-target attribute, which is the column index to search.\r\n *\r\n * @param selector {string}\r\n */\r\nexport const initIncludeSearch = (selector) => {\r\n    $(selector).each(function() {\r\n        addIncludeSearch($(this));\r\n    });\r\n};\r\n\r\n/**\r\n * Adds a specific select element to the datatables search, for an include search value search.\r\n *\r\n * @param element {jQuery} The element the search relates to.\r\n */\r\nexport const addIncludeSearch = (element) => {\r\n    $.fn.dataTable.ext.search.push(function(settings, data) {\r\n        /**\r\n         * @type {string[]}\r\n         */\r\n        const include = element.val() ?? [];\r\n\r\n        let index = getTargetColumnIndexes(settings, element);\r\n        if (index === null) {\r\n            return true;\r\n        }\r\n        index = index[0];\r\n\r\n        /**\r\n         * @type {string}\r\n         */\r\n        const value = data[index];\r\n\r\n        if (include.length) {\r\n            return include.every((item) => value.includes(item));\r\n        }\r\n        return true;\r\n    });\r\n};\r\n\r\n/**\r\n * This function adds an event listener to the given selector that will redraw the given table\r\n *\r\n * @param selector {string}\r\n * @param table {*}\r\n */\r\nexport const addRedrawEvent = (selector, table) => {\r\n    $(selector).on('change keyup clear', function() {\r\n        table.draw();\r\n    });\r\n};\r\n\r\n/**\r\n *\r\n * @param settings {*}\r\n * @param className {string}\r\n *\r\n * @returns {null|int}\r\n */\r\nconst getIndexByClass = (settings, className) => {\r\n    for (const index in settings.aoColumns) {\r\n        if (settings.aoColumns[index].nTh.classList.contains(className)) {\r\n            return +index;\r\n        }\r\n    }\r\n\r\n    return null;\r\n};\r\n\r\n/**\r\n *\r\n * @param settings {*}\r\n * @param element {jQuery}\r\n * @returns {null|int[]}\r\n */\r\nconst getTargetColumnIndexes = (settings, element) => {\r\n    const targetData = element.data('target');\r\n\r\n    // It´s not set? Return null.\r\n    if (targetData === undefined) {\r\n        // eslint-disable-next-line no-console\r\n        console.error('data-target is not defined or not a number for', element);\r\n        return null;\r\n    }\r\n\r\n    //if it´s just a single number, return it\r\n    if (!isNaN(targetData)) {\r\n        return [targetData];\r\n    }\r\n\r\n    //Split it, so we can support multiple classes.\r\n    const targetArray = targetData.split(',');\r\n\r\n    //Map the array to the index.\r\n    return targetArray.map((target) => {\r\n        // It´s a number? Return it.\r\n        if (!isNaN(target)) {\r\n            return target;\r\n        }\r\n\r\n        // It´s a string? Try to find the index by the class name.\r\n        return getIndexByClass(settings, target);\r\n    });\r\n};\r\n\r\nexport const makeTablesFullWidth = function () {\r\n    if (document.querySelector('.dataTable') !== null) {\r\n        // make page and table full width\r\n        document.querySelector('body').classList.add('hasDatatable');\r\n        $('.dataTable').css('width', '');\r\n    }\r\n};\r\n"],"names":["selector","table","each","this","on","elementValue","column","type","checked","value","isNaN","data","search","draw","addOrSearch","element","fn","dataTable","ext","push","settings","searchVal","val","indexes","getTargetColumnIndexes","index","includes","addMinSearch","min","attr","Date","getTime","addIncludeSearch","include","length","every","item","targetData","undefined","console","error","split","map","target","className","aoColumns","nTh","classList","contains","getIndexByClass","document","querySelector","add","css"],"mappings":"6gBAUgC,CAACA,SAAUC,6BACrCD,UAAUE,MAAK,+BACXC,MAAMC,GAAG,sBAAsB,eACzBC,aAQAC,OALAD,aADc,aAAdF,KAAKI,KACUJ,KAAKK,QAAU,EAAI,GAEnBL,KAAKM,MAMpBH,OADAI,OAAM,mBAAEP,MAAMQ,KAAK,WACVV,MAAMK,mBAAW,mBAAEH,MAAMQ,KAAK,YAE9BV,MAAMK,QAAO,mBAAEH,MAAMQ,KAAK,WAEvCL,OAAOM,OAAOP,cAAcQ,oCAWXb,+BACvBA,UAAUE,MAAK,WACbY,aAAY,mBAAEX,iBASTW,YAAeC,0BACtBC,GAAGC,UAAUC,IAAIN,OAAOO,MAAK,SAASC,SAAUT,2BAC1CU,+BAAYN,QAAQO,2CAAS,OAG5BD,iBACM,QAGLE,QAAUC,uBAAuBJ,SAAUL,YACjC,OAAZQ,eACO,MAGN,MAAME,SAASF,WAIZZ,KAAKc,OAAOC,SAASL,kBACd,SAGR,8DAUerB,+BACxBA,UAAUE,MAAK,WACbyB,cAAa,mBAAExB,iBASVwB,aAAgBZ,0BACvBC,GAAGC,UAAUC,IAAIN,OAAOO,MAAK,SAASC,SAAUT,4BAC1CiB,0BAAMb,QAAQO,6CAAS,OAEtBM,WACM,KAGkB,SAAzBb,QAAQc,KAAK,QAAoB,CAEjCD,IADgB,IAAIE,KAAKF,KACXG,UAAY,QAG1BN,MAAQD,uBAAuBJ,SAAUL,YAC/B,OAAVU,aACO,EAEXA,MAAQA,MAAM,SAKRhB,OAASE,KAAKc,cAChBG,KACOnB,OAASmB,sEAaM5B,+BAC5BA,UAAUE,MAAK,WACb8B,kBAAiB,mBAAE7B,iBASd6B,iBAAoBjB,0BAC3BC,GAAGC,UAAUC,IAAIN,OAAOO,MAAK,SAASC,SAAUT,8BAIxCsB,8BAAUlB,QAAQO,6CAAS,OAE7BG,MAAQD,uBAAuBJ,SAAUL,YAC/B,OAAVU,aACO,EAEXA,MAAQA,MAAM,SAKRhB,MAAQE,KAAKc,cAEfQ,QAAQC,QACDD,QAAQE,OAAOC,MAAS3B,MAAMiB,SAASU,+EAY5B,CAACpC,SAAUC,6BACnCD,UAAUI,GAAG,sBAAsB,WACjCH,MAAMY,iBA2BRW,uBAAyB,CAACJ,SAAUL,iBAChCsB,WAAatB,QAAQJ,KAAK,kBAGb2B,IAAfD,kBAEAE,QAAQC,MAAM,iDAAkDzB,SACzD,SAINL,MAAM2B,kBACA,CAACA,mBAIQA,WAAWI,MAAM,KAGlBC,KAAKC,QAEfjC,MAAMiC,QArCK,EAACvB,SAAUwB,iBAC1B,MAAMnB,SAASL,SAASyB,aACrBzB,SAASyB,UAAUpB,OAAOqB,IAAIC,UAAUC,SAASJ,kBACzCnB,aAIT,MAmCIwB,CAAgB7B,SAAUuB,QAJtBA,uCAQgB,WACc,OAAzCO,SAASC,cAAc,gBAEvBD,SAASC,cAAc,QAAQJ,UAAUK,IAAI,oCAC3C,cAAcC,IAAI,QAAS"}