{"version":3,"file":"datatables-helpers.min.js","sources":["../src/datatables-helpers.js"],"sourcesContent":["/* eslint-disable jsdoc/require-param-type, valid-jsdoc */\nimport $ from 'jquery';\nimport 'local_learningcompanions/jquery.dataTables';\n\n/**\n * Adds a default \"value is included in the column\" search to the datatables search.\n *\n * @param selector {string}\n * @param table {*}\n */\nexport const setupSearchRules = (selector, table) => {\n    $(selector).each(function() {\n        $(this).on('keyup change clear', function() {\n            let elementValue;\n\n            if (this.type === 'checkbox') {\n                elementValue = this.checked ? 1 : '';\n            } else {\n                elementValue = this.value;\n            }\n\n            let column;\n            // Check of the target is a number\n            if (isNaN($(this).data('target'))) {\n                column = table.column(`.${$(this).data('target')}`);\n            } else {\n                column = table.column($(this).data('target'));\n            }\n            column.search(elementValue).draw();\n        });\n    });\n};\n\n/**\n * Adds the elements to the datatables search, for a minimum value search.\n * The elements need a data-target attribute, which is the column index to search.\n *\n * @param selector\n */\nexport const initMinSearch = (selector) => {\n    $(selector).each(function() {\n        addMinSearch($(this));\n    });\n};\n\n/**\n * Adds a specific element to the datatables search, for a minimum value search.\n *\n * @param element {jQuery} The element the search relates to.\n */\nexport const addMinSearch = (element) => {\n    $.fn.dataTable.ext.search.push(function(settings, data) {\n        let min = element.val() ?? '';\n\n        if (!min) {\n            return true;\n        }\n\n        if (element.attr('type') === 'date') {\n            const minDate = new Date(min);\n            min = minDate.getTime() / 1000;\n        }\n\n        const index = getTargetColumnIndex(settings, element);\n        if (index === null) {\n            return true;\n        }\n\n        /**\n         * @type {number}\n         */\n        const value = +data[index];\n        if (min) {\n            return value >= min;\n        }\n        return true;\n    });\n};\n\n/**\n * Adds a specific select element to the datatables search, for an include search value search.\n * The element should be an element, that can select multiple values. Otherwise, just use the setupSearchRules function.\n * The elements should have a data-target attribute, which is the column index to search.\n *\n * @param selector {string}\n */\nexport const initIncludeSearch = (selector) => {\n    $(selector).each(function() {\n        addIncludeSearch($(this));\n    });\n};\n\n/**\n * Adds a specific select element to the datatables search, for an include search value search.\n *\n * @param element {jQuery} The element the search relates to.\n */\nexport const addIncludeSearch = (element) => {\n    $.fn.dataTable.ext.search.push(function(settings, data) {\n        /**\n         * @type {string[]}\n         */\n        const include = element.val() ?? [];\n\n        const index = getTargetColumnIndex(settings, element);\n        if (index === null) {\n            return true;\n        }\n\n        /**\n         * @type {string}\n         */\n        const value = data[index];\n\n        if (include.length) {\n            return include.every((item) => value.includes(item));\n        }\n        return true;\n    });\n};\n\n/**\n * This function adds an event listener to the given selector that will redraw the given table\n *\n * @param selector {string}\n * @param table {*}\n */\nexport const addRedrawEvent = (selector, table) => {\n    $(selector).on('change keyup clear', function() {\n        table.draw();\n    });\n};\n\n/**\n *\n * @param settings {*}\n * @param className {string}\n *\n * @returns {null|int}\n */\nconst getIndexByClass = (settings, className) => {\n    for (const index in settings.aoColumns) {\n        if (settings.aoColumns[index].nTh.classList.contains(className)) {\n            return +index;\n        }\n    }\n\n    return null;\n};\n\n/**\n *\n * @param settings {*}\n * @param element {jQuery}\n * @returns {null|int}\n */\nconst getTargetColumnIndex = (settings, element) => {\n    const target = element.data('target');\n\n    // It´s not set? Return null.\n    if (target === undefined) {\n        // eslint-disable-next-line no-console\n        console.error('data-target is not defined or not a number for', element);\n        return null;\n    }\n\n    // It´s a number? Return it.\n    if (!isNaN(target)) {\n        return target;\n    }\n\n    // It´s a string? Try to find the index by the class name.\n    return getIndexByClass(settings, target);\n};\n"],"names":["selector","table","each","this","on","elementValue","type","checked","value","isNaN","data","column","search","draw","addMinSearch","element","fn","dataTable","ext","push","settings","min","val","attr","Date","getTime","index","getTargetColumnIndex","addIncludeSearch","include","length","every","item","includes","target","undefined","console","error","className","aoColumns","nTh","classList","contains","getIndexByClass"],"mappings":"ycAUgC,SAACA,SAAUC,2BACrCD,UAAUE,MAAK,+BACXC,MAAMC,GAAG,sBAAsB,eACzBC,aAGAA,aADc,aAAdF,KAAKG,KACUH,KAAKI,QAAU,EAAI,GAEnBJ,KAAKK,OAKpBC,OAAM,mBAAEN,MAAMO,KAAK,WACVT,MAAMU,mBAAW,mBAAER,MAAMO,KAAK,YAE9BT,MAAMU,QAAO,mBAAER,MAAMO,KAAK,YAEhCE,OAAOP,cAAcQ,qCAWX,SAACb,8BACxBA,UAAUE,MAAK,WACbY,cAAa,mBAAEX,eASVW,aAAe,SAACC,yBACvBC,GAAGC,UAAUC,IAAIN,OAAOO,MAAK,SAASC,SAAUV,uBAC1CW,yBAAMN,QAAQO,2CAAS,OAEtBD,WACM,EAGkB,SAAzBN,QAAQQ,KAAK,UAEbF,IADgB,IAAIG,KAAKH,KACXI,UAAY,SAGxBC,MAAQC,qBAAqBP,SAAUL,YAC/B,OAAVW,aACO,MAMLlB,OAASE,KAAKgB,cAChBL,KACOb,OAASa,sEAaK,SAACrB,8BAC5BA,UAAUE,MAAK,WACb0B,kBAAiB,mBAAEzB,eASdyB,iBAAmB,SAACb,yBAC3BC,GAAGC,UAAUC,IAAIN,OAAOO,MAAK,SAASC,SAAUV,wBAIxCmB,8BAAUd,QAAQO,6CAAS,GAE3BI,MAAQC,qBAAqBP,SAAUL,YAC/B,OAAVW,aACO,MAMLlB,MAAQE,KAAKgB,cAEfG,QAAQC,QACDD,QAAQE,OAAM,SAACC,aAASxB,MAAMyB,SAASD,gFAY5B,SAAChC,SAAUC,2BACnCD,UAAUI,GAAG,sBAAsB,WACjCH,MAAMY,eA2BRc,qBAAuB,SAACP,SAAUL,aAC9BmB,OAASnB,QAAQL,KAAK,sBAGbyB,IAAXD,QAEAE,QAAQC,MAAM,iDAAkDtB,SACzD,MAINN,MAAMyB,QA3BS,SAACd,SAAUkB,eAC1B,IAAMZ,SAASN,SAASmB,aACrBnB,SAASmB,UAAUb,OAAOc,IAAIC,UAAUC,SAASJ,kBACzCZ,aAIT,KAyBAiB,CAAgBvB,SAAUc,QAJtBA"}