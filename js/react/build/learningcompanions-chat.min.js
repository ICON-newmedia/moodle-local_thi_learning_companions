(function(c,W){"use strict";var b={exports:{}},O={};var J=c,K=Symbol.for("react.element"),Y=Symbol.for("react.fragment"),z=Object.prototype.hasOwnProperty,Q=J.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,X={key:!0,ref:!0,__self:!0,__source:!0};function A(e,n,l){var o,r={},m=null,u=null;l!==void 0&&(m=""+l),n.key!==void 0&&(m=""+n.key),n.ref!==void 0&&(u=n.ref);for(o in n)z.call(n,o)&&!X.hasOwnProperty(o)&&(r[o]=n[o]);if(e&&e.defaultProps)for(o in n=e.defaultProps,n)r[o]===void 0&&(r[o]=n[o]);return{$$typeof:K,type:e,key:m,ref:u,props:r,_owner:Q.current}}O.Fragment=Y,O.jsx=A,O.jsxs=A,function(e){e.exports=O}(b);const Z=b.exports.Fragment,t=b.exports.jsx,g=b.exports.jsxs;var N={},D=W;N.createRoot=D.createRoot,N.hydrateRoot=D.hydrateRoot;function k({timestamp:e,format:n={year:"numeric",month:"2-digit",day:"2-digit"}}){if(e=e??0,e=parseInt(e),e===0)return t("div",{className:"learningcompanions_chat_time",children:"No Time!"});const l=new Date(e*1e3),o=new Intl.DateTimeFormat(void 0,n).format(l);return t("div",{className:"learningcompanions_chat_time",children:o})}function q({handleGroupSelect:e,group:n,activeGroupid:l}){const{name:o,id:r,description:m,chatid:u,shortdescription:E,imageurl:S,latestcomment:v,isPreview:_}=n,P=function(){e(r,u)};let i="d-flex learningcompanions_chat-group";return typeof l<"u"&&parseInt(l)===parseInt(r)&&(i+=" learningcompanions_currentgroup"),_&&(i+=" learningcompanions_previewgroup"),g("div",{onClick:P,id:"learningcompanions_chat-group-"+r,className:i,children:[t("img",{className:"learningcompanions_group_image_small",src:S}),g("div",{className:"learningcompanions_group_infos",children:[t("em",{children:o}),t("br",{}),t("span",{children:E})]}),t(k,{timestamp:v})]})}function x({loading:e}){return e?t("div",{className:"learningcompanions_loading"}):null}const p={on(e,n,l={}){return document.addEventListener(e,o=>n(o.detail),l),this},off(e,n){return this.remove(e,n)},dispatch(e,n){return document.dispatchEvent(new CustomEvent(e,{detail:n})),this},remove(e,n){return document.removeEventListener(e,n),this},events:{GROUP_CHANGED:"groupchanged",MESSAGE_DELETED:"learningcompanions_message_deleted",MESSAGE_REPORTED:"learningcompanions_message_reported"}},C=".js-chat-preview",j="#fitem_id_message",T="#fitem_id_attachments",U=".fdescription.required";function $({activeGroupid:e,previewGroup:n}){typeof window.M>"u"&&(window.M={cfg:{wwwroot:""}});const[l,o]=c.useState([]),[r,m]=c.useState(e),[u,E]=c.useState(0),[S,v]=c.useState(!0);c.useEffect(()=>{var h,G,L,I;const i=(h=l.find(w=>+w.id==+r))==null?void 0:h.chatid,f=((G=l.find(w=>+w.id==+r))==null?void 0:G.isPreviewGroup)??!1;let y=i;f?(console.log("I make the input invisible"),y="",(L=document.querySelector(C))==null||L.classList.replace("d-none","d-flex"),document.querySelectorAll(`${j}, ${T}, ${U}`).forEach(w=>w.classList.add("d-none"))):(console.log("I make the input Visible"),(I=document.querySelector(C))==null||I.classList.replace("d-flex","d-none"),document.querySelectorAll(`${j}, ${T}, ${U}`).forEach(w=>w.classList.remove("d-none"))),document.querySelector('input[name="chatid"]').value=y,console.log(`setting active group id to: ${r} and chatid to: ${i}`)},[r,l]);function _(i){p.dispatch(p.events.GROUP_CHANGED,{groupid:i});const f=new URLSearchParams(window.location.search);f.set("groupid",i),f.delete("postId"),window.history.replaceState(null,"Chat",`${window.M.cfg.wwwroot}/local/learningcompanions/chat.php?${f}`),m(i)}function P(){const i=new AbortController,f=new URLSearchParams(window.location.search).get("previewGroup"),y=new URLSearchParams;return f&&y.set("previewGroup",f),fetch(`${M.cfg.wwwroot}/local/learningcompanions/ajaxgrouplist.php?${y}`,{signal:i.signal}).then(h=>h.json()).then(({groups:h})=>{o(h),v(!1)}).catch(h=>{h.name!=="AbortError"&&console.log("Error: "+h.message)}),()=>i.abort()}return c.useEffect(P,[u]),c.useEffect(()=>{const i=window.setInterval(()=>{E(f=>f+1)},5e4);return()=>{window.clearInterval(i)}},[]),g("div",{id:"learningcompanions_chat-grouplist",children:[S&&t(x,{}),l.map(i=>t(q,{handleGroupSelect:_,group:i,activeGroupid:r},i.id))]})}function ee({attachment:e}){const{url:n,filename:l}=e;return t("div",{children:t("a",{target:"_blank",href:n,children:l})})}function te({attachments:e=[]}){return e.map(n=>t(ee,{attachment:n}))}function ne({id:e}){return t("a",{href:"#","data-id":e,title:"Delete",className:"learningcompanions_delete_comment"})}function oe({id:e}){return t("a",{href:"#","data-id":e,title:"Report",className:"learningcompanions_report_comment"})}function re({highlighted:e,post:n,isPreview:l}){const{author:o,id:r,timecreated:m,comment:u,attachments:E,flagged:S,timedeleted:v}=n;let _=!1,P=!1,i;return typeof window.learningcompanions_chat_userid!==void 0&&+o.id==+window.learningcompanions_chat_userid?(_=!0,i="learningcompanions_chat-my-post"):(P=!0,i="learningcompanions_chat-other-post"),+S&&(i+=" learningcompanions_chat-reported-post"),g("div",{id:`learningcompanions_chat-post-${r}`,className:`learningcompanions_chat-post ${i}`,children:[g("strong",{children:[o.firstname," ",o.lastname]}),t("br",{}),t("em",{children:t(k,{timestamp:m,format:{year:"numeric",month:"2-digit",day:"2-digit",weekday:"long"}})}),t("br",{}),!+v&&t("div",{dangerouslySetInnerHTML:{__html:u}}),!!+v&&t("div",{children:t("i",{children:"Message Deleted"})}),!+v&&!!E.length&&t(te,{attachments:E}),g("div",{className:"action-button-wrapper",children:[!l&&_&&t(ne,{id:r}),!l&&P&&!+S&&t(oe,{id:r})]}),g("span",{children:["ID: ",r]}),e&&g(Z,{children:[t("br",{}),t("span",{className:"highlighted-post",children:"Highlighted"})]})]})}function se({group:e}){return g("div",{className:"learningcompanions_groupheader",children:[t("div",{className:"learningcompanions_groupimage",style:{backgroundImage:"url("+e.imageurl+")"}}),t("h1",{children:e.name}),t("a",{href:"#",className:"learningcompanions_editgroup","data-gid":e.id,"data-title":e.name})]})}function ie({activeGroupid:e,previewGroup:n}){typeof window.M>"u"&&(window.M={cfg:{wwwroot:""}});const[l,o]=c.useState([]),[r,m]=c.useState({}),[u,E]=c.useState(e),[S,v]=c.useState(0),[_,P]=c.useState(!0),[i,f]=c.useState(null),[y,h]=c.useState(null),G=new URLSearchParams(window.location.search).get("postId");console.log("Group",r),console.log("isPreviewGroup",r.isPreviewGroup);const L=r.isPreviewGroup??!1;let I=!1;const w=c.useCallback(s=>{E(s.groupid)},[]),F=c.useCallback(({postid:s})=>{o(a=>a.map(d=>(+d.id==+s&&(d.timedeleted=1),d)))},[]),B=c.useCallback(({postid:s})=>{o(a=>a.map(d=>(+d.id==+s&&(d.flagged=!0),d)))},[]);c.useEffect(()=>(p.on(p.events.GROUP_CHANGED,w),p.on(p.events.MESSAGE_DELETED,F),p.on(p.events.MESSAGE_REPORTED,B),()=>{p.off(p.events.GROUP_CHANGED,w),p.off(p.events.MESSAGE_DELETED,F),p.off(p.events.MESSAGE_REPORTED,B)}),[]),c.useEffect(()=>{if(!G)return;const s=document.querySelector(`#learningcompanions_chat-post-${G}`);console.log("Found element:",s),s&&s.scrollIntoView()},[_]);function le(){if(y===null||I)return;I=!0;const s=new AbortController;return fetch(`${M.cfg.wwwroot}/local/learningcompanions/ajaxchat.php?`+new URLSearchParams({groupid:u,firstPostId:y}),{signal:s.signal}).then(a=>a.json()).then(a=>{const d=a.posts;d.length&&(o(R=>[...R,...d]),h(d[d.length-1].id))}).catch(a=>{a.name!=="AbortError"&&console.log(a)}).finally(()=>{I=!1}),()=>s.abort()}function de(){const s=new AbortController;return fetch(M.cfg.wwwroot+"/local/learningcompanions/ajaxchat.php?"+new URLSearchParams({groupid:u,includedPostId:G}),{signal:s.signal}).then(a=>a.json()).then(a=>{var R,V;const d=a.posts;o(d),m(a.group),P(!1),f(((R=d[0])==null?void 0:R.id)??0),h(((V=d[d.length-1])==null?void 0:V.id)??1/0)}).catch(a=>{a.name!=="AbortError"&&console.log(a)}),()=>s.abort()}function pe(){if(i===null)return;const s=new AbortController;return fetch(`${M.cfg.wwwroot}/local/learningcompanions/ajax_newmessages.php?groupId=${u}&lastPostId=${i}`,{signal:s.signal}).then(a=>a.json()).then(a=>{const d=a.posts;d.length&&(o(R=>[...d,...R]),f(d[0].id))}),()=>s.abort()}return c.useEffect(de,[u]),c.useEffect(pe,[S]),c.useEffect(()=>{const s=window.setInterval(()=>{v(a=>a+1)},3e4);return()=>{window.clearInterval(s)}},[]),g("div",{id:"learningcompanions_chat-postlist",children:[_&&t(x,{}),t(se,{group:r}),L&&t("span",{children:"Is Preview"}),t("div",{className:"post-wrapper",onScroll:s=>{-s.target.scrollTop+s.target.clientHeight>=s.target.scrollHeight&&le()},children:l.map(s=>t(re,{post:s,isPreview:L,highlighted:s.id===G},s.id))})]})}const ae=N.createRoot(document.getElementById("learningcompanions_groups-content")),ce=N.createRoot(document.getElementById("learningcompanions_chat-content")),H=new URLSearchParams(window.location.search).get("previewGroup");ae.render(t(React.StrictMode,{children:t($,{previewGroup:H,activeGroupid:window.learningcompanions_groupid})})),ce.render(t(React.StrictMode,{children:t(ie,{previewGroup:H,activeGroupid:window.learningcompanions_groupid})}))})(React,ReactDOM);
