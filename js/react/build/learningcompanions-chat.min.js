(function(a,k){"use strict";var _={exports:{}},g={};var E=a,G=Symbol.for("react.element"),L=Symbol.for("react.fragment"),x=Object.prototype.hasOwnProperty,j=E.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,A={key:!0,ref:!0,__self:!0,__source:!0};function I(e,t,l){var i,o={},s=null,d=null;l!==void 0&&(s=""+l),t.key!==void 0&&(s=""+t.key),t.ref!==void 0&&(d=t.ref);for(i in t)x.call(t,i)&&!A.hasOwnProperty(i)&&(o[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps,t)o[i]===void 0&&(o[i]=t[i]);return{$$typeof:G,type:e,key:s,ref:d,props:o,_owner:j.current}}g.Fragment=L,g.jsx=I,g.jsxs=I,function(e){e.exports=g}(_);const n=_.exports.jsx,m=_.exports.jsxs;var h={},O=k;h.createRoot=O.createRoot,h.hydrateRoot=O.hydrateRoot;function P({timestamp:e}){if(e=e??0,console.log("timestamp: ",e),e=parseInt(e),e===0)return n("div",{className:"learningcompanions_chat_time"});const t=new Intl.DateTimeFormat(void 0,{year:"numeric",month:"2-digit",day:"2-digit"}).format(date);return console.log("lastActive: ",t),n("div",{className:"learningcompanions_chat_time",children:t})}function C({handleGroupSelect:e,name:t,id:l,description:i,shortdescription:o,imageurl:s,latestcomment:d,activeGroupid:u}){const p=function(){e(l)};let f="learningcompanions_chat-group";return typeof u<"u"&&parseInt(u)===parseInt(l)&&(f+=" learningcompanions_currentgroup"),m("div",{onClick:p,id:"learningcompanions_chat-group-"+l,className:f,children:[n(P,{timestamp:d}),n("img",{className:"learningcompanions_group_image_small",src:s}),n("em",{children:t}),n("br",{}),n("span",{children:o}),n("br",{})]})}function S({loading:e}){return e?n("div",{className:"learningcompanions_loading"}):null}const v={on(e,t){document.addEventListener(e,l=>t(l.detail))},dispatch(e,t){document.dispatchEvent(new CustomEvent(e,{detail:t}))},remove(e,t){document.removeEventListener(e,t)}};function D(e){typeof window.M>"u"&&(window.M={cfg:{wwwroot:""}});const[t,l]=a.useState([]),[i,o]=a.useState(e.activeGroupid),[s,d]=a.useState(0),[u,p]=a.useState(!0);function f(r){v.dispatch("groupchanged",{groupid:r}),o(r),document.querySelector('input[name="chatid"]').value=r,console.log("setting active group id to: ",r)}function w(){const r=new AbortController;async function y(){const c=await(await fetch(M.cfg.wwwroot+"/local/learningcompanions/ajaxgrouplist.php")).json();l(c.groups),console.log("got groups via AJAX:",c.groups),p(!1)}return y(),()=>r.abort()}return a.useEffect(w,[i,s]),a.useEffect(()=>{const r=window.setInterval(()=>{d(s+1)},5e4);return()=>{window.clearInterval(r)}}),m("div",{id:"learningcompanions_chat-grouplist s",children:[n(S,{loading:u}),t.map(r=>n(C,{handleGroupSelect:f,name:r.name,id:r.id,shortdescription:r.shortdescription,description:r.description,imageurl:r.imageurl,latestcomment:r.latestcomment,activeGroupid:i},r.id))]})}function F(e){return n("div",{children:n("a",{target:"_blank",href:e.attachment.url,children:e.attachment.filename})})}function T({attachments:e}){if(!(!e||e.length===0))return e.map(t=>n(F,{attachment:t}))}function B({author:e,id:t,datetime:l,comment:i,attachments:o}){let s;console.log("attachments: ",o),o&&o.length>0?s=n(T,{attachments:o}):s=" ";let d,u,p;return typeof learningcompanions_chat_userid<"u"&&parseInt(e.id)===parseInt(learningcompanions_chat_userid)?(d=n("a",{href:"#","data-id":t,className:"learningcompanions_edit_comment",children:"edit"}),u=n("a",{href:"#","data-id":t,className:"learningcompanions_delete_comment",children:"delete"}),p="learningcompanions_chat-my-post"):(d=n("a",{href:"#","data-id":t,className:"learningcompanions_report_comment",children:"report"}),u="",p="learningcompanions_chat-other-post"),m("div",{id:"learningcompanions_chat-post-"+t,className:"learningcompanions_chat-post "+p,children:[m("strong",{children:[e.firstname," ",e.lastname]}),n("br",{}),n("em",{children:l}),n("br",{}),n("div",{dangerouslySetInnerHTML:{__html:i}}),s,d," ",u]})}function q({group:e}){return m("div",{className:"learningcompanions_groupheader",children:[n("div",{className:"learningcompanions_groupimage",style:{backgroundImage:"url("+e.imageurl+")"}}),n("h1",{children:e.name}),n("a",{href:"#",className:"learningcompanions_editgroup","data-gid":e.id,"data-title":e.name})]})}function $(e){typeof window.M>"u"&&(window.M={cfg:{wwwroot:""}});const[t,l]=a.useState([]),[i,o]=a.useState({}),[s,d]=a.useState(e.activeGroupid),[u,p]=a.useState(0),[f,w]=a.useState(!0),[r,y]=a.useState(0);v.on("groupchanged",c=>{d(c.groupid)}),v.on("learningcompanions_message_deleted",()=>{y(r+1)});function b(){const c=new AbortController;async function U(K){const N=await(await fetch(M.cfg.wwwroot+"/local/learningcompanions/ajaxchat.php?groupid="+K)).json();let W=Object.values(N.posts);l(W),o(N.group),w(!1)}return U(s),()=>c.abort()}return a.useEffect(b,[s,u,r]),a.useEffect(()=>{const c=window.setInterval(()=>{p(u+1)},1e4);return console.log("Adding Interval",c),()=>{console.log("clearing interval",c),window.clearInterval(c)}},[]),m("div",{id:"learningcompanions_chat-postlist",children:[n(S,{loading:f}),n(q,{group:i}),t.map(c=>n(B,{author:c.author,id:c.id,datetime:c.datetime,comment:c.comment,attachments:c.attachments},c.id))]})}const H=h.createRoot(document.getElementById("learningcompanions_groups-content")),J=h.createRoot(document.getElementById("learningcompanions_chat-content"));H.render(n(a.StrictMode,{children:n(D,{activeGroupid:window.learningcompanions_groupid})})),J.render(n(a.StrictMode,{children:n($,{activeGroupid:window.learningcompanions_groupid})}))})(React,ReactDOM);
