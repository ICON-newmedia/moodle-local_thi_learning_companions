(function(i,P){"use strict";var y={exports:{}},w={};var L=i,k=Symbol.for("react.element"),A=Symbol.for("react.fragment"),j=Object.prototype.hasOwnProperty,D=L.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,x={key:!0,ref:!0,__self:!0,__source:!0};function G(e,n,d){var s,a={},c=null,u=null;d!==void 0&&(c=""+d),n.key!==void 0&&(c=""+n.key),n.ref!==void 0&&(u=n.ref);for(s in n)j.call(n,s)&&!x.hasOwnProperty(s)&&(a[s]=n[s]);if(e&&e.defaultProps)for(s in n=e.defaultProps,n)a[s]===void 0&&(a[s]=n[s]);return{$$typeof:k,type:e,key:c,ref:u,props:a,_owner:D.current}}w.Fragment=A,w.jsx=G,w.jsxs=G,function(e){e.exports=w}(y);const t=y.exports.jsx,g=y.exports.jsxs;var v={},N=P;v.createRoot=N.createRoot,v.hydrateRoot=N.hydrateRoot;function C({timestamp:e}){if(e=e??0,e=parseInt(e),e===0)return t("div",{className:"learningcompanions_chat_time"});const n=new Intl.DateTimeFormat(void 0,{year:"numeric",month:"2-digit",day:"2-digit"}).format(date);return console.log("lastActive: ",n),t("div",{className:"learningcompanions_chat_time",children:n})}function B({handleGroupSelect:e,name:n,id:d,description:s,shortdescription:a,imageurl:c,latestcomment:u,activeGroupid:p}){const f=function(){e(d)};let m="learningcompanions_chat-group";return typeof p<"u"&&parseInt(p)===parseInt(d)&&(m+=" learningcompanions_currentgroup"),g("div",{onClick:f,id:"learningcompanions_chat-group-"+d,className:m,children:[t(C,{timestamp:u}),t("img",{className:"learningcompanions_group_image_small",src:c}),t("em",{children:n}),t("br",{}),t("span",{children:a}),t("br",{})]})}function I({loading:e}){return e?t("div",{className:"learningcompanions_loading"}):null}const h={on(e,n){document.addEventListener(e,d=>n(d.detail))},dispatch(e,n){document.dispatchEvent(new CustomEvent(e,{detail:n}))},remove(e,n){document.removeEventListener(e,n)},events:{GROUP_CHANGED:"groupchanged",MESSAGE_DELETED:"learningcompanions_message_deleted"}};function T(e){typeof window.M>"u"&&(window.M={cfg:{wwwroot:""}});const[n,d]=i.useState([]),[s,a]=i.useState(e.activeGroupid),[c,u]=i.useState(0),[p,f]=i.useState(!0);function m(l){h.dispatch(h.events.GROUP_CHANGED,{groupid:l}),a(l),document.querySelector('input[name="chatid"]').value=l,console.log("setting active group id to: ",l)}function E(){const l=new AbortController;async function S(){const O=await(await fetch(M.cfg.wwwroot+"/local/learningcompanions/ajaxgrouplist.php")).json();d(O.groups),f(!1)}return S(),()=>l.abort()}return i.useEffect(E,[s,c]),i.useEffect(()=>{const l=window.setInterval(()=>{u(c+1)},5e4);return()=>{window.clearInterval(l)}},[]),g("div",{id:"learningcompanions_chat-grouplist s",children:[t(I,{loading:p}),n.map(l=>t(B,{handleGroupSelect:m,name:l.name,id:l.id,shortdescription:l.shortdescription,description:l.description,imageurl:l.imageurl,latestcomment:l.latestcomment,activeGroupid:s},l.id))]})}function F(e){return t("div",{children:t("a",{target:"_blank",href:e.attachment.url,children:e.attachment.filename})})}function H({attachments:e}){if(!(!e||e.length===0))return e.map(n=>t(F,{attachment:n}))}function U({id:e}){return t("a",{href:"#","data-id":e,className:"learningcompanions_edit_comment",children:"edit"})}function q({id:e}){return t("a",{href:"#","data-id":e,className:"learningcompanions_delete_comment",children:"delete"})}function W({id:e}){return t("a",{href:"#","data-id":e,className:"learningcompanions_report_comment",children:"report"})}function $({author:e,id:n,datetime:d,comment:s,attachments:a}){let c;a&&a.length?c=t(H,{attachments:a}):c="";let u=!1,p=!1,f=!1,m;return typeof window.learningcompanions_chat_userid!==void 0&&+e.id==+window.learningcompanions_chat_userid?(u=!0,p=!0,m="learningcompanions_chat-my-post"):(f=!0,m="learningcompanions_chat-other-post"),g("div",{id:"learningcompanions_chat-post-"+n,className:"learningcompanions_chat-post "+m,children:[g("strong",{children:[e.firstname," ",e.lastname]}),t("br",{}),t("em",{children:d}),t("br",{}),t("div",{dangerouslySetInnerHTML:{__html:s}}),c,u&&t(U,{id:n}),p&&t(q,{id:n}),f&&t(W,{id:n})]})}function J({group:e}){return g("div",{className:"learningcompanions_groupheader",children:[t("div",{className:"learningcompanions_groupimage",style:{backgroundImage:"url("+e.imageurl+")"}}),t("h1",{children:e.name}),t("a",{href:"#",className:"learningcompanions_editgroup","data-gid":e.id,"data-title":e.name})]})}function R(e){typeof window.M>"u"&&(window.M={cfg:{wwwroot:""}});const[n,d]=i.useState([]),[s,a]=i.useState({}),[c,u]=i.useState(1),[p,f]=i.useState(e.activeGroupid),[m,E]=i.useState(0),[l,S]=i.useState(!0),[b,O]=i.useState(0);h.on(h.events.GROUP_CHANGED,o=>{f(o.groupid),u(1)}),h.on(h.events.MESSAGE_DELETED,()=>{O(b+1)});function z(){const o=new AbortController;return fetch(M.cfg.wwwroot+"/local/learningcompanions/ajaxchat.php?groupid="+p+"&page="+c,{signal:o.signal}).then(r=>r.json()).then(r=>{const _=Object.values(r.posts);console.log(r),d(X=>[...X,..._])}).catch(r=>{r.name==="AbortError"?console.log("Fetch aborted"):console.log(r)}),()=>o.abort()}const Q=()=>{const o=new AbortController;return fetch(M.cfg.wwwroot+"/local/learningcompanions/ajaxchat.php?groupid="+p,{signal:o.signal}).then(r=>r.json()).then(r=>{const _=Object.values(r.posts).reverse();d(_),a(r.group),S(!1)}).catch(r=>{r.name==="AbortError"?console.log("Fetch aborted"):console.log(r)}),()=>o.abort()},V=()=>{const o=Math.random().toString(36).substring(7),r={author:{firstname:"John",lastname:"Doe"},datetime:new Date().toLocaleString(),comment:"This is a new post "+o,attachments:[],id:o};d(_=>[r,..._])};return i.useEffect(z,[c]),i.useEffect(Q,[p,b]),i.useEffect(V,[m]),i.useEffect(()=>{const o=window.setInterval(()=>{E(r=>r+1)},3e4);return()=>{window.clearInterval(o)}},[]),g("div",{id:"learningcompanions_chat-postlist",children:[t(I,{loading:l}),t(J,{group:s}),t("div",{className:"post-wrapper",onScroll:o=>{-o.target.scrollTop+o.target.clientHeight>=o.target.scrollHeight&&u(r=>r+1)},children:n.map(o=>t($,{author:o.author,id:o.id,datetime:o.datetime,comment:o.comment,attachments:o.attachments},o.id))})]})}const K=v.createRoot(document.getElementById("learningcompanions_groups-content")),Y=v.createRoot(document.getElementById("learningcompanions_chat-content"));K.render(t(i.StrictMode,{children:t(T,{activeGroupid:window.learningcompanions_groupid})})),Y.render(t(i.StrictMode,{children:t(R,{activeGroupid:window.learningcompanions_groupid})}))})(React,ReactDOM);
